# test_dalle3_detailed.py
# –∑–∞–ø—É—Å–∫  python test_dalle3_detailed.py

import replicate
import os

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –¢–û–ö–ï–ù –í –ö–ê–í–´–ß–ö–ê–•
os.environ["REPLICATE_API_TOKEN"] = "r8_U5d7rljYIDPGnffQkcVKHixtJNVsUHN1BspkN"

# ‚úÖ –ñ–Å–°–¢–ö–ò–ô –î–ï–¢–ê–õ–¨–ù–´–ô –ü–†–û–ú–¢
ULTRA_DETAILED_PROMPT = """
–í—ã –º–∞—Å—Ç–µ—Ä –¥–∏–∑–∞–π–Ω–∞ –º–∏—Ä–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è.
–°–æ–∑–¥–∞–π—Ç–µ  –¥–∏–∑–∞–π–Ω –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –¥–µ–≤–æ—á–∫–∏ –∏ –≤—ã–≤–µ–¥–∏—Ç–µ –µ–≥–æ –≤ —É–ª—å—Ç—Ä–∞ —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–º —Ä–µ–∂–∏–º–µ.
–î–∏–∑–∞–π–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –ø—Ä–∏–¥—É–º–∞–Ω–Ω—ã–º, –Ω–µ –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–º, –∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º –∏ –ø—Ä–æ—Å—Ç—ã–º, –±–µ–∑ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å—Ç—É–ª—å–µ–≤.
–ó–∞–ø—Ä–µ—â–µ–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ–±–µ–ª—å, –ø—Ä–µ–¥–º–µ—Ç—ã –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ.
–°—Ç–∏–ª—å: –º–∏–Ω–∏–º–∞–ª–∏–∑–º.
–î–µ—Ç–∞–ª–∏:
–∫–æ–º–Ω–∞—Ç–∞ —à–∏—Ä–∏–Ω–∞ - 3 –º–µ—Ç—Ä–∞, –¥–ª–∏–Ω–∞ -5 –º–µ—Ç—Ä–æ–≤, –≤—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤ -2, 7 –º–µ—Ç—Ä–∞.

–ú–µ–±–µ–ª—å: –¥–∏–≤–∞–Ω, —Ç–µ–ª–µ–≤–∏–∑–æ—Ä, –Ω–æ—É—Ç–±—É–∫, —É–≥–ª–æ–≤–æ–π —Å—Ç–æ–ª, –∫—Ä–µ—Å–ª–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ.
–ò–Ω—Ç–µ—Ä—å–µ—Ä: —Å—Ç–µ–Ω—ã —Ä–æ–∑–æ–≤—ã–µ –±–µ–∑ –æ–±–æ–µ–≤, –ø–æ–ª –ª–∞–º–∏–Ω–∞—Ç –æ—á–µ–Ω—å —Ç–µ–º–Ω—ã–π –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç –æ–∫–Ω–∞, 
–ø–æ—Ç–æ–ª–æ–∫ –æ–±—ã—á–Ω—ã–π –Ω–µ –Ω–∞–≤–∞–µ—Å–Ω–æ–π - –±–µ–ª—ã–π.
"""

print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ñ–Å–°–¢–ö–û–ì–û –ü–†–û–ú–¢–ê...")
print(f"üìù –ü—Ä–æ–º—Ç –¥–ª–∏–Ω–∞: {len(ULTRA_DETAILED_PROMPT)} —Å–∏–º–≤–æ–ª–æ–≤")
print("‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...")

try:
    output = replicate.run(
        "openai/dall-e-3",
        input={
            "prompt": ULTRA_DETAILED_PROMPT,
            "size": "1024x1024",
        }
    )

    print(f"üîç Output type: {type(output)}")
    print(f"üîç Output: {output}")

    # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê
    if output:
        if isinstance(output, list) and len(output) > 0:
            file_obj = output[0]
            if hasattr(file_obj, 'url'):
                image_url = file_obj.url
            else:
                image_url = str(file_obj)
        elif hasattr(output, 'url'):
            image_url = output.url
        else:
            image_url = str(output)

        print(f"‚úÖ –£–°–ü–ï–®–ù–û!")
        print(f"üì∏ URL: {image_url}")

        # –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        import webbrowser

        webbrowser.open(image_url)
        print("üåê –û—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
    else:
        print("‚ùå –û—à–∏–±–∫–∞: –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç")

except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    import traceback

    traceback.print_exc()
