# ๐บ๏ธ ะะะะขะ ะญะะะะะะ InteriorBot-v2

**ะะตััะธั:** 2.0  
**ะะฐัะฐ:** 27 ะฝะพัะฑัั 2024  
**ะะฐะทะฝะฐัะตะฝะธะต:** ะััััะฐั ะฝะฐะฒะธะณะฐัะธั ะฟะพ ัะบัะฐะฝะฐะผ ะฑะพัะฐ ะดะปั ะพัะปะฐะดะบะธ ะธ ัะฐะทัะฐะฑะพัะบะธ

---

## ๐ ะะะะะะะะะะ

- [ะัะฝะพะฒะฝะพะน Flow](#ะพัะฝะพะฒะฝะพะน-flow)
- [ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะบัะฐะฝะพะฒ](#ะดะตัะฐะปัะฝะพะต-ะพะฟะธัะฐะฝะธะต-ัะบัะฐะฝะพะฒ)
- [ะกัะตะผะฐ ะฟะตัะตัะพะดะพะฒ](#ััะตะผะฐ-ะฟะตัะตัะพะดะพะฒ)

---

## ๐ ะะกะะะะะะ FLOW

```
START (ะญะบัะฐะฝ 1)
    โ
    โโโ ๐ค ะัะพัะธะปั (ะญะบัะฐะฝ 2) โโ ๐ณ ะะพะบัะฟะบะฐ ัะพะบะตะฝะพะฒ (ะญะบัะฐะฝ 13)
    โ
    โโโ ๐ ะะปั ะดะพะผะฐ (ะญะบัะฐะฝ 3) โโ
    โ                          โ
    โโโ ๐ผ ะะปั ะฑะธะทะฝะตัะฐ (ะญะบัะฐะฝ 4) โโ
                               โ
                               โผ
                    ๐จ ะัะฑะพั ัะตะถะธะผะฐ (ะญะบัะฐะฝ 5)
                               โ
                โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
                โ                             โ
                โผ                             โผ
    ๐จ ะะพัะผะพััะตัั ะดะธะทะฐะนะฝ          ๐๏ธ ะกะพะทะดะฐัั ัะฒะพะน
         (ะญะบัะฐะฝ 8)                     (ะญะบัะฐะฝ 9)
                โ                          โ
                โ                          โผ
                โ                   ะะตะฑะตะปั (ะญะบัะฐะฝ 9)
                โ                          โ
                โ                          โผ
                โ                   ะฆะฒะตัะฐ (ะญะบัะฐะฝ 10)
                โ                          โ
                โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                           โ
                           โผ
                    โณ ะะตะฝะตัะฐัะธั (ะญะบัะฐะฝ 11)
                           โ
                           โผ
                    โจ ะะตะทัะปััะฐั (ะญะบัะฐะฝ 12)
```

---

## ๐ฑ ะะะขะะะฌะะะ ะะะะกะะะะ ะญะะะะะะ

### **ะญะะะะ 1: START / MAIN_MENU**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะะปะฐะฒะฝะพะต ะผะตะฝั ะฑะพัะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/user_start.py`  
**๐ง ะคัะฝะบัะธะธ:**
- `start_command()` โ ะฟัะธ `/start`
- `go_to_main_menu()` โ ะฟัะธ callback `main_menu`

**๐ ะขะตะบัั:** `MAIN_MENU_TEXT` (ะธะท `utils/texts.py`)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_main_menu_keyboard()` (ะธะท `keyboards/inline.py`)

**ะะฝะพะฟะบะธ:**
- ๐ ะะปั ะดะพะผะฐ โ ะญะบัะฐะฝ 3
- ๐ผ ะะปั ะฑะธะทะฝะตัะฐ โ ะญะบัะฐะฝ 4
- ๐ค ะัะพัะธะปั โ ะญะบัะฐะฝ 2

**State:** `MainMenuStates.main_menu`

---

### **ะญะะะะ 2: PROFILE**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั ั ะฑะฐะปะฐะฝัะพะผ ัะพะบะตะฝะพะฒ  
**๐ ะคะฐะนะป:** `bot/handlers/user_start.py`  
**๐ง ะคัะฝะบัะธั:** `profile_callback()`

**๐ ะขะตะบัั:** `PROFILE_TEXT` (ะดะธะฝะฐะผะธัะตัะบะธ ัะพัะผะฐัะธััะตััั ั `user_id`, `username`, `balance`)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_profile_keyboard()`

**ะะฝะพะฟะบะธ:**
- ๐ณ ะัะฟะธัั ัะพะบะตะฝั โ ะญะบัะฐะฝ 13
- โฌ๏ธ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**State:** `MainMenuStates.profile`

---

### **ะญะะะะ 3: HOME_MENU**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ะบะพะผะฝะฐัั ะดะปั ะดะพะผะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/user_start.py`  
**๐ง ะคัะฝะบัะธั:** `home_menu()`

**๐ ะขะตะบัั:** `HOME_TEXT`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_home_rooms_keyboard()`

**ะะฝะพะฟะบะธ (12 ะบะพะผะฝะฐั ะฟะพ 2 ะฒ ััะด):**
- ๐๏ธ ะกัะพะปะพะฒะฐั โ `room_dining_room`
- ๐ณ ะััะฝั โ `room_kitchen`
- ๐๏ธ ะะพััะธะฝะฐั โ `room_living_room`
- ๐๏ธ ะกะฟะฐะปัะฝั โ `room_bedroom`
- ๐ผ ะะฐะฑะธะฝะตั โ `room_office_work`
- ๐ช ะะฐัะดะตัะพะฑะฝะฐั โ `room_wardrobe_closet`
- ๐ถ ะะตััะบะฐั โ `room_kids_room`
- ๐ก ะัะธัะพะถะฐั โ `room_entrance_hall`
- ๐ฝ ะกะฐะฝัะทะตะป โ `room_toilet_restroom`
- ๐ ะะฐะฝะฝะฐั โ `room_bathroom_bath`
- ๐ช ะะฐะปะบะพะฝ โ `room_balcony_terrace`
- ๐ณ ะัะถัะบะฐั ะฑะตัะปะพะณะฐ โ `room_manroom_den`
- โฌ๏ธ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**ะัะธ ะฒัะฑะพัะต ะบะพะผะฝะฐัั:** โ ะญะบัะฐะฝ 5 (Design Mode Selector)

**State:** `MainMenuStates.home_menu`

---

### **ะญะะะะ 4: BUSINESS_MENU**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ะฟะพะผะตัะตะฝะธั ะดะปั ะฑะธะทะฝะตัะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/user_start.py`  
**๐ง ะคัะฝะบัะธั:** `business_menu()`

**๐ ะขะตะบัั:** `BUSINESS_TEXT`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_business_rooms_keyboard()`

**ะะฝะพะฟะบะธ (10 ะฟะพะผะตัะตะฝะธะน ะฟะพ 2 ะฒ ััะด):**
- ๐ข ะัะธั โ `room_office_business`
- ๐ฝ๏ธ ะะตััะพัะฐะฝ โ `room_restaurant`
- โ ะะฐัะต โ `room_cafe`
- ๐ฆท ะกัะพะผะฐัะพะปะพะณะธั โ `room_dental`
- ๐ ะะฐััะฐะถะฝัะน ัะฐะปะพะฝ โ `room_massage`
- ๐ฆ ะกะบะปะฐะด โ `room_warehouse`
- ๐๏ธ ะะฐะณะฐะทะธะฝ โ `room_shop`
- ๐ ะกะฐะปะพะฝ ะบัะฐัะพัั โ `room_salon`
- ๐๏ธ ะคะธัะฝะตั-ะบะปัะฑ โ `room_gym`
- ๐ช ะัะพะดัะบัะพะฒัะน โ `room_grocery`
- โฌ๏ธ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**ะัะธ ะฒัะฑะพัะต ะฟะพะผะตัะตะฝะธั:** โ ะญะบัะฐะฝ 5 (Design Mode Selector)

**State:** `MainMenuStates.business_menu`

---

### **ะญะะะะ 5: DESIGN_MODE_SELECTOR**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ัะตะถะธะผะฐ ัะพะทะดะฐะฝะธั ะดะธะทะฐะนะฝะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/user_start.py`  
**๐ง ะคัะฝะบัะธั:** `room_selected()`

**๐ ะขะตะบัั:** `DESIGN_MODE_TEXT` (ะฟะพะบะฐะทัะฒะฐะตั ะฒัะฑัะฐะฝะฝัั ะบะพะผะฝะฐัั)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_design_mode_keyboard()`

**ะะฝะพะฟะบะธ:**
- ๐จ ะะพัะผะพััะตัั ะธ ะฒัะฑัะฐัั ะดะธะทะฐะนะฝ โ ะญะบัะฐะฝ 8 (ะฒัะฑะพั ััะธะปั)
- ๐๏ธ ะกะพะทะดะฐัั ัะฒะพะน ะธะฝัะตััะตั โ ะญะบัะฐะฝ 9 (ะฒัะฑะพั ะผะตะฑะตะปะธ)
- โฌ๏ธ ะะฐะทะฐะด ะบ ะบะพะผะฝะฐัะฐะผ โ ะญะบัะฐะฝ 3 ะธะปะธ 4
- ๐ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**State:** `CreationStates.choose_mode`

---

### **ะญะะะะ 6: UPLOAD_PHOTO** (ะะ ะะกะะะะฌะะฃะะขะกะฏ ะ ะขะะะฃะฉะะ ะะะะกะะ)

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะะถะธะดะฐะฝะธะต ะทะฐะณััะทะบะธ ัะพัะพ ะบะพะผะฝะฐัั  
**๐ ะคะฐะนะป:** `bot/handlers/creation.py`  
**๐ง ะคัะฝะบัะธั:** `choose_new_photo()`

**๐ ะขะตะบัั:** `UPLOAD_PHOTO_TEXT`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** ะะตั (ะพะถะธะดะฐะฝะธะต ัะพัะพ)

**State:** `CreationStates.waiting_for_photo`

**ะัะธะผะตัะฐะฝะธะต:** ะ ัะตะบััะตะน ะฒะตััะธะธ ัะพัะพ ะฝะต ะธัะฟะพะปัะทัะตััั, ะฝะพ ััะฝะบัะธะพะฝะฐะป ะพััะฐะฒะปะตะฝ ะดะปั ะฑัะดััะธั ะพะฑะฝะพะฒะปะตะฝะธะน.

---

### **ะญะะะะ 7: CHOOSE_ROOM** (ะะะกะะ ะะะะะฃะะะ ะคะะขะ)

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ัะธะฟะฐ ะบะพะผะฝะฐัั ะฟะพัะปะต ะทะฐะณััะทะบะธ ัะพัะพ  
**๐ ะคะฐะนะป:** `bot/handlers/creation.py`  
**๐ง ะคัะฝะบัะธั:** `photo_uploaded()`

**๐ ะขะตะบัั:** `PHOTO_SAVED_TEXT`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_room_keyboard()` (4 ะบะพะผะฝะฐัั)

**State:** `CreationStates.choose_room`

**ะัะธะผะตัะฐะฝะธะต:** ะ ัะตะบััะตะน ะฒะตััะธะธ ััะพั ัะบัะฐะฝ ะฝะต ะฐะบัะธะฒะตะฝ, ัะฐะบ ะบะฐะบ ะฒัะฑะพั ะบะพะผะฝะฐัั ะฟัะพะธััะพะดะธั ัะตัะตะท ะญะบัะฐะฝั 3-4.

---

### **ะญะะะะ 8: CHOOSE_STYLE**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ััะธะปั ะดะธะทะฐะนะฝะฐ ะธะฝัะตััะตัะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/creation.py`  
**๐ง ะคัะฝะบัะธะธ:**
- `room_chosen()` โ ะฟัะธ ะฒัะฑะพัะต ะบะพะผะฝะฐัั
- `mode_select_design()` โ ะฟัะธ ะฒัะฑะพัะต ัะตะถะธะผะฐ "ะะพัะผะพััะตัั ะดะธะทะฐะนะฝ" (ะธะท `user_start.py`)
- `change_style_after_gen()` โ ะฟัะธ ะฝะฐะถะฐัะธะธ "ะััะณะพะน ััะธะปั" ะฟะพัะปะต ะณะตะฝะตัะฐัะธะธ

**๐ ะขะตะบัั:** `CHOOSE_STYLE_TEXT` (ะฟะพะบะฐะทัะฒะฐะตั ะฒัะฑัะฐะฝะฝัั ะบะพะผะฝะฐัั: `{room_name}`)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_style_keyboard()`

**ะะฝะพะฟะบะธ (10 ััะธะปะตะน ะฟะพ 2 ะฒ ััะด):**
- ๐ข ะกะพะฒัะตะผะตะฝะฝัะน โ `style_modern`
- โฌ ะะธะฝะธะผะฐะปะธะทะผ โ `style_minimalism`
- ๐ธ๐ช ะกะบะฐะฝะดะธะฝะฐะฒัะบะธะน โ `style_scandinavian`
- ๐ญ ะะพัั โ `style_loft`
- ๐พ ะัััะธะบ โ `style_rustic`
- ๐๏ธ ะะถะฐะฟะฐะฝะดะธ โ `style_japandi`
- ๐ธ ะะพัะพ โ `style_boho`
- ๐ ะกัะตะดะธะทะตะผะฝะพะผะพััะบะธะน โ `style_mediterranean`
- ๐ป Mid-century โ `style_midcentury`
- ๐ ะั-ะดะตะบะพ โ `style_art_deco`
- โฌ๏ธ ะะฐะทะฐะด โ ะญะบัะฐะฝ 5 (Design Mode Selector)
- ๐ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**ะัะธ ะฒัะฑะพัะต ััะธะปั:** โ ะญะบัะฐะฝ 11 (ะะตะฝะตัะฐัะธั)

**State:** `CreationStates.choose_style`

---

### **ะญะะะะ 9: CHOOSE_FURNITURE**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ะผะตะฑะตะปะธ ะดะปั ะบะฐััะพะผะฝะพะณะพ ะดะธะทะฐะนะฝะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/design_step1_furniture.py`  
**๐ง ะคัะฝะบัะธะธ:**
- `show_furniture_screen()` โ ะฟะพะบะฐะท ัะบัะฐะฝะฐ
- `toggle_furniture()` โ ะฟะตัะตะบะปััะตะฝะธะต ะฒัะฑะพัะฐ ะผะตะฑะตะปะธ (callback `furn:{key}`)
- `go_to_colors()` โ ะฟะตัะตัะพะด ะบ ัะฒะตัะฐะผ (callback `to_colors`)

**๐ ะขะตะบัั:** ะะธะฝะฐะผะธัะตัะบะธะน (ะทะฐะฒะธัะธั ะพั ะบะพะผะฝะฐัั ะธ ะฒัะฑัะฐะฝะฝะพะน ะผะตะฑะตะปะธ)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** ะะธะฝะฐะผะธัะตัะบะฐั (ะทะฐะฒะธัะธั ะพั ะบะพะผะฝะฐัั)

**ะัะธะผะตัั ะผะตะฑะตะปะธ (ะดะปั ะบััะฝะธ):**
- ๐ฝ๏ธ ะะฑะตะดะตะฝะฝัะน ััะพะป
- ๐ณ ะะฐัะฝะธััั
- ๐ง ะฅะพะปะพะดะธะปัะฝะธะบ
- ๐ท ะะฐัะฝะฐั ััะพะนะบะฐ
- ๐ก ะะพะดัะฒะตัะบะฐ
- ๐ชฃ ะััะพัะฝะพะต ะฒะตะดัะพ
- ๐ง ะะธะบัะพะฒะพะปะฝะพะฒะบะฐ
- ๐ ะะพะปะบะธ

**ะะฝะพะฟะบะธ ะฝะฐะฒะธะณะฐัะธะธ:**
- โฌ๏ธ ะะฐะทะฐะด โ ะญะบัะฐะฝ 5 (Design Mode Selector)
- โก๏ธ ะะะะะ: ะฆะะะขะ โ ะญะบัะฐะฝ 10

**State:** `CreationStates.choose_furniture`

---

### **ะญะะะะ 10: CHOOSE_COLORS**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ัะฒะตัะพะฒ ััะตะฝ, ะฟะพะปะฐ, ะผะตะฑะตะปะธ  
**๐ ะคะฐะนะป:** `bot/handlers/design_step2_colors.py`  
**๐ง ะคัะฝะบัะธะธ:**
- `show_colors_screen()` โ ะฟะพะบะฐะท ัะบัะฐะฝะฐ ัะฒะตัะพะฒ
- ะะฐะทะปะธัะฝัะต callback-ััะฝะดะปะตัั ะดะปั ะฒัะฑะพัะฐ ัะฒะตัะพะฒ

**๐ ะขะตะบัั:** ะะธะฝะฐะผะธัะตัะบะธะน (ะฟะพะบะฐะทัะฒะฐะตั ัะตะบััะธะน ัะฐะณ: ััะตะฝั/ะฟะพะป/ะผะตะฑะตะปั)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** ะะธะฝะฐะผะธัะตัะบะฐั (ะฟะฐะปะธััะฐ ัะฒะตัะพะฒ)

**ะจะฐะณะธ ะฒัะฑะพัะฐ:**
1. ะฆะฒะตั ััะตะฝ
2. ะฆะฒะตั ะฟะพะปะฐ
3. ะฆะฒะตั ะผะตะฑะตะปะธ

**ะะฝะพะฟะบะธ ะฝะฐะฒะธะณะฐัะธะธ:**
- โฌ๏ธ ะะฐะทะฐะด โ ะญะบัะฐะฝ 9 (ะะตะฑะตะปั)
- โ ะะพัะพะฒะพ โ ะญะบัะฐะฝ 11 (ะะตะฝะตัะฐัะธั)

**State:** `CreationStates.choose_furniture` (ะธัะฟะพะปัะทัะตััั ัะพั ะถะต state)

---

### **ะญะะะะ 11: GENERATING**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะพัะตัั ะณะตะฝะตัะฐัะธะธ ะธะทะพะฑัะฐะถะตะฝะธั ะดะธะทะฐะนะฝะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/creation.py`  
**๐ง ะคัะฝะบัะธั:** `style_chosen()` (ะฒะฝัััะธ ััะฝะบัะธะธ)

**๐ ะขะตะบัั:** `"โณ ะะตะฝะตัะธััั ะฝะพะฒัะน ะดะธะทะฐะนะฝ..."`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** ะะตั

**ะัะพัะตัั:**
1. ะัะพะฒะตัะบะฐ ะฑะฐะปะฐะฝัะฐ ัะพะบะตะฝะพะฒ
2. ะกะฟะธัะฐะฝะธะต 1 ัะพะบะตะฝะฐ
3. ะัะทะพะฒ `generate_image()` ะธะท `services/replicate_api.py`
4. ะะตะฝะตัะฐัะธั ัะตัะตะท DALL-E 3 (Replicate API)
5. ะะพะปััะตะฝะธะต URL ะธะทะพะฑัะฐะถะตะฝะธั

**ะัะตะผั:** ~20-40 ัะตะบัะฝะด

**ะะพัะปะต ะณะตะฝะตัะฐัะธะธ:**
- ะฃัะฟะตั โ ะญะบัะฐะฝ 12 (ะะตะทัะปััะฐั)
- ะัะธะฑะบะฐ โ ะกะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต + ะญะบัะฐะฝ 1

**State:** ะะตั (ะฟัะพัะตัั)

---

### **ะญะะะะ 12: RESULT**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะบะฐะท ะณะพัะพะฒะพะณะพ ะดะธะทะฐะนะฝะฐ  
**๐ ะคะฐะนะป:** `bot/handlers/creation.py`  
**๐ง ะคัะฝะบัะธั:** `style_chosen()` (ะฟะพัะปะต ััะฟะตัะฝะพะน ะณะตะฝะตัะฐัะธะธ)

**๐ ะขะตะบัั:** `"ะงัะพ ะดะฐะปััะต?"`  
**๐ผ๏ธ ะะทะพะฑัะฐะถะตะฝะธะต:** ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน ะดะธะทะฐะนะฝ ะธะฝัะตััะตัะฐ  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_post_generation_keyboard()`

**ะะฝะพะฟะบะธ:**
- ๐จ ะััะณะพะน ััะธะปั โ ะญะบัะฐะฝ 8 (ะฒัะฑะพั ััะธะปั ั ัะพะน ะถะต ะบะพะผะฝะฐัะพะน)
- ๐ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**State:** ะขะตะบััะธะน state ัะพััะฐะฝัะตััั (room ะพััะฐัััั ะฒ state)

---

### **ะญะะะะ 13: PAYMENT_PACKAGES**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฑะพั ะฟะฐะบะตัะฐ ัะพะบะตะฝะพะฒ ะดะปั ะฟะพะบัะฟะบะธ  
**๐ ะคะฐะนะป:** `bot/handlers/payment.py`  
**๐ง ะคัะฝะบัะธั:** `show_packages()`

**๐ ะขะตะบัั:** `"ะัะฑะตัะธัะต ะฟะฐะบะตั ะณะตะฝะตัะฐัะธะน:"`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_payment_keyboard()`

**ะะฝะพะฟะบะธ (ะฟะฐะบะตัั):**
- ๐ 10 ัะพะบะตะฝะพะฒ - 290โฝ โ `pay_10_290`
- ๐ 25 ัะพะบะตะฝะพะฒ - 490โฝ โ `pay_25_490`
- ๐ 60 ัะพะบะตะฝะพะฒ - 990โฝ โ `pay_60_990`
- โฌ๏ธ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**ะัะธ ะฒัะฑะพัะต ะฟะฐะบะตัะฐ:** โ ะญะบัะฐะฝ 14 (Payment Created)

**State:** ะะตั

---

### **ะญะะะะ 14: PAYMENT_CREATED**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะญะบัะฐะฝ ะฟะพัะปะต ัะพะทะดะฐะฝะธั ะฟะปะฐัะตะถะฐ ะฒ YooKassa  
**๐ ะคะฐะนะป:** `bot/handlers/payment.py`  
**๐ง ะคัะฝะบัะธั:** `create_payment()`

**๐ ะขะตะบัั:** `PAYMENT_CREATED` (ะฟะพะบะฐะทัะฒะฐะตั ััะผะผั ะธ ะบะพะปะธัะตััะฒะพ ัะพะบะตะฝะพะฒ)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_payment_check_keyboard(confirmation_url)`

**ะะฝะพะฟะบะธ:**
- ๐ ะะตัะตะนัะธ ะบ ะพะฟะปะฐัะต (URL ะฝะฐ YooKassa)
- โ ะัะพะฒะตัะธัั ะฟะปะฐััะถ โ ะฒัะทะพะฒ `check_payment()`
- โฌ๏ธ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**ะัะธ ััะฟะตัะฝะพะน ะพะฟะปะฐัะต:** โ ะญะบัะฐะฝ 15

**State:** ะะตั

---

### **ะญะะะะ 15: PAYMENT_SUCCESS**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะฃัะฟะตัะฝะฐั ะพะฟะปะฐัะฐ, ัะพะบะตะฝั ะทะฐัะธัะปะตะฝั  
**๐ ะคะฐะนะป:** `bot/handlers/payment.py`  
**๐ง ะคัะฝะบัะธั:** `check_payment()` (ะฟัะธ ััะฟะตัะต)

**๐ ะขะตะบัั:** `PAYMENT_SUCCESS_TEXT` (ะฟะพะบะฐะทัะฒะฐะตั ะฝะพะฒัะน ะฑะฐะปะฐะฝั)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_main_menu_keyboard()`

**ะะฝะพะฟะบะธ:**
- ๐ ะะปั ะดะพะผะฐ โ ะญะบัะฐะฝ 3
- ๐ผ ะะปั ะฑะธะทะฝะตัะฐ โ ะญะบัะฐะฝ 4
- ๐ค ะัะพัะธะปั โ ะญะบัะฐะฝ 2

**State:** ะะตั

---

### **ะญะะะะ 16: NO_BALANCE**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะะตะดะพััะฐัะพัะฝะพ ัะพะบะตะฝะพะฒ ะดะปั ะณะตะฝะตัะฐัะธะธ  
**๐ ะคะฐะนะป:** `bot/handlers/creation.py`  
**๐ง ะคัะฝะบัะธั:** ะะฐะทะปะธัะฝัะต ะผะตััะฐ ะฟัะธ ะฟัะพะฒะตัะบะต ะฑะฐะปะฐะฝัะฐ (ะฝะฐะฟัะธะผะตั, `photo_uploaded()`, `room_chosen()`, `style_chosen()`)

**๐ ะขะตะบัั:** `NO_BALANCE_TEXT`  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** `get_payment_keyboard()`

**ะะฝะพะฟะบะธ:**
- ๐ 10 ัะพะบะตะฝะพะฒ - 290โฝ โ ะญะบัะฐะฝ 14
- ๐ 25 ัะพะบะตะฝะพะฒ - 490โฝ โ ะญะบัะฐะฝ 14
- ๐ 60 ัะพะบะตะฝะพะฒ - 990โฝ โ ะญะบัะฐะฝ 14
- โฌ๏ธ ะะปะฐะฒะฝะพะต ะผะตะฝั โ ะญะบัะฐะฝ 1

**State:** ะัะธัะฐะตััั (`state.clear()`)

---

### **ะญะะะะ 17: ADMIN_PANEL**

**๐ ะะฐะทะฝะฐัะตะฝะธะต:** ะะดะผะธะฝ-ะฟะฐะฝะตะปั ัะพ ััะฐัะธััะธะบะพะน  
**๐ ะคะฐะนะป:** `bot/handlers/admin.py`  
**๐ง ะคัะฝะบัะธั:** ะะฐะทะปะธัะฝัะต ะฐะดะผะธะฝัะบะธะต ััะฝะดะปะตัั

**๐ ะขะตะบัั:** ะะธะฝะฐะผะธัะตัะบะธะน (ััะฐัะธััะธะบะฐ, ะฐะฝะฐะปะธัะธะบะฐ)  
**โจ๏ธ ะะปะฐะฒะธะฐัััะฐ:** ะะดะผะธะฝัะบะฐั ะบะปะฐะฒะธะฐัััะฐ

**ะะพัััะฟ:** ะขะพะปัะบะพ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธะท `ADMIN_IDS` (config.py)

**State:** ะะตั

---

## ๐ ะกะฅะะะ ะะะะะฅะะะะ

### ะะปะฐะฒะฝัะต ะฟััะธ ะฟะพะปัะทะพะฒะฐัะตะปั:

**1. ะัััััะน ะฟััั (ะณะพัะพะฒัะน ะดะธะทะฐะนะฝ):**
```
ะญะบัะฐะฝ 1 โ ะญะบัะฐะฝ 3/4 โ ะญะบัะฐะฝ 5 โ ะญะบัะฐะฝ 8 โ ะญะบัะฐะฝ 11 โ ะญะบัะฐะฝ 12
(ะกัะฐัั โ ะะพะผะฝะฐัั โ ะะตะถะธะผ โ ะกัะธะปั โ ะะตะฝะตัะฐัะธั โ ะะตะทัะปััะฐั)
```

**2. ะะฐััะพะผะฝัะน ะฟััั (ัะฒะพะน ะดะธะทะฐะนะฝ):**
```
ะญะบัะฐะฝ 1 โ ะญะบัะฐะฝ 3/4 โ ะญะบัะฐะฝ 5 โ ะญะบัะฐะฝ 9 โ ะญะบัะฐะฝ 10 โ ะญะบัะฐะฝ 11 โ ะญะบัะฐะฝ 12
(ะกัะฐัั โ ะะพะผะฝะฐัั โ ะะตะถะธะผ โ ะะตะฑะตะปั โ ะฆะฒะตัะฐ โ ะะตะฝะตัะฐัะธั โ ะะตะทัะปััะฐั)
```

**3. ะะพะบัะฟะบะฐ ัะพะบะตะฝะพะฒ:**
```
ะญะบัะฐะฝ 1 โ ะญะบัะฐะฝ 2 โ ะญะบัะฐะฝ 13 โ ะญะบัะฐะฝ 14 โ ะญะบัะฐะฝ 15 โ ะญะบัะฐะฝ 1
(ะกัะฐัั โ ะัะพัะธะปั โ ะะฐะบะตัั โ ะะฟะปะฐัะฐ โ ะฃัะฟะตั โ ะกัะฐัั)
```

**4. ะะตั ะฑะฐะปะฐะฝัะฐ:**
```
ะญะบัะฐะฝ 8 (ะธะปะธ ะดััะณะพะน) โ ะญะบัะฐะฝ 16 โ ะญะบัะฐะฝ 13 โ ะญะบัะฐะฝ 14 โ ะญะบัะฐะฝ 15
(ะะพะฟััะบะฐ ะณะตะฝะตัะฐัะธะธ โ ะะตั ะฑะฐะปะฐะฝัะฐ โ ะะพะบัะฟะบะฐ)
```

---

## ๐ CALLBACK DATA (ะดะปั ะพัะปะฐะดะบะธ)

### ะัะฝะพะฒะฝัะต callback'ะธ:

| Callback | ะะตะนััะฒะธะต | ะญะบัะฐะฝ ะพัะบัะดะฐ | ะญะบัะฐะฝ ะบัะดะฐ |
|----------|----------|--------------|------------|
| `main_menu` | ะะปะฐะฒะฝะพะต ะผะตะฝั | ะัะฑะพะน | 1 |
| `menu_home` | ะะปั ะดะพะผะฐ | 1 | 3 |
| `menu_business` | ะะปั ะฑะธะทะฝะตัะฐ | 1 | 4 |
| `menu_profile` | ะัะพัะธะปั | 1 | 2 |
| `room_{ะฝะฐะทะฒะฐะฝะธะต}` | ะัะฑะพั ะบะพะผะฝะฐัั | 3 ะธะปะธ 4 | 5 |
| `mode_select_design` | ะะตะถะธะผ "ะะพัะผะพััะตัั" | 5 | 8 |
| `mode_create_custom` | ะะตะถะธะผ "ะกะพะทะดะฐัั ัะฒะพะน" | 5 | 9 |
| `style_{ะฝะฐะทะฒะฐะฝะธะต}` | ะัะฑะพั ััะธะปั | 8 | 11 |
| `furn:{key}` | Toggle ะผะตะฑะตะปะธ | 9 | 9 |
| `to_colors` | ะ ัะฒะตัะฐะผ | 9 | 10 |
| `change_style` | ะััะณะพะน ััะธะปั | 12 | 8 |
| `buy_generations` | ะัะฟะธัั ัะพะบะตะฝั | 2 | 13 |
| `pay_{ัะพะบะตะฝั}_{ัะตะฝะฐ}` | ะกะพะทะดะฐัั ะฟะปะฐััะถ | 13 | 14 |
| `check_payment` | ะัะพะฒะตัะธัั ะฟะปะฐััะถ | 14 | 15 ะธะปะธ ะพัะธะฑะบะฐ |
| `back_to_rooms` | ะะฐะทะฐะด ะบ ะบะพะผะฝะฐัะฐะผ | 5 | 3 ะธะปะธ 4 |
| `back_to_mode_selection` | ะะฐะทะฐะด ะบ ัะตะถะธะผั | 8, 9 | 5 |
| `back_to_room` | ะะฐะทะฐะด ะบ ะบะพะผะฝะฐัะต | 8 | 7 |

---

## ๐๏ธ ะะซะกะขะะะฏ ะะขะะะะะ

### ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั ััั ะบะฐััั:

1. **ะัะพะฑะปะตะผะฐ ะฝะฐ ัะบัะฐะฝะต:**
   - ะกะผะพััะธะผ ะฝะพะผะตั ัะบัะฐะฝะฐ ะฒ ะพะฟะธัะฐะฝะธะธ
   - ะะฐัะพะดะธะผ ัะฐะนะป ะธ ััะฝะบัะธั
   - ะัะฐะฒะธะผ ะบะพะด

2. **ะัะพะฑะปะตะผะฐ ั ะฟะตัะตัะพะดะพะผ:**
   - ะกะผะพััะธะผ callback ะฒ ัะฐะฑะปะธัะต
   - ะะฐัะพะดะธะผ ะพะฑัะฐะฑะพััะธะบ callback'ะฐ
   - ะัะพะฒะตััะตะผ ะปะพะณะธะบั ะฟะตัะตัะพะดะฐ

3. **ะัะพะฑะปะตะผะฐ ั ัะตะบััะพะผ:**
   - ะะฐัะพะดะธะผ ะบะพะฝััะฐะฝัั ัะตะบััะฐ (ะฝะฐะฟัะธะผะตั, `CHOOSE_STYLE_TEXT`)
   - ะะดัะผ ะฒ `bot/utils/texts.py`
   - ะัะฐะฒะธะผ ัะตะบัั

4. **ะัะพะฑะปะตะผะฐ ั ะบะปะฐะฒะธะฐัััะพะน:**
   - ะะฐัะพะดะธะผ ััะฝะบัะธั ะบะปะฐะฒะธะฐัััั (ะฝะฐะฟัะธะผะตั, `get_style_keyboard()`)
   - ะะดัะผ ะฒ `bot/keyboards/inline.py`
   - ะัะฐะฒะธะผ ะบะฝะพะฟะบะธ

---

## ๐ ะะะะะะะซ ะะกะะะะฌะะะะะะะฏ

### ะัะธะผะตั 1: "ะะฐ ัะบัะฐะฝะต 8 ะฝะต ะฟะพะบะฐะทัะฒะฐะตััั ะบะพะผะฝะฐัะฐ"

1. ะกะผะพััะธะผ ะญะบัะฐะฝ 8 โ ัะฐะนะป `handlers/creation.py`, ััะฝะบัะธั `room_chosen()`
2. ะัะพะฒะตััะตะผ, ััะพ ัะตะบัั ัะพัะผะฐัะธััะตััั: `CHOOSE_STYLE_TEXT.format(room_name=room_name)`
3. ะัะพะฒะตััะตะผ, ััะพ ะฒ `texts.py` ะตััั ะฟะปะตะนััะพะปะดะตั `{room_name}`

### ะัะธะผะตั 2: "ะะพัะปะต ะฒัะฑะพัะฐ ััะธะปั ะฝะต ะฟัะพะธััะพะดะธั ะฟะตัะตัะพะด"

1. ะกะผะพััะธะผ ะญะบัะฐะฝ 8 โ callback `style_{ะฝะฐะทะฒะฐะฝะธะต}`
2. ะะฐัะพะดะธะผ ะพะฑัะฐะฑะพััะธะบ `style_chosen()` ะฒ `handlers/creation.py`
3. ะัะพะฒะตััะตะผ ะปะพะณะธะบั ะฟะตัะตัะพะดะฐ ะบ ะญะบัะฐะฝั 11

### ะัะธะผะตั 3: "ะะฝะพะฟะบะฐ 'ะะฐะทะฐะด' ะฝะฐ ัะบัะฐะฝะต ะฒัะฑะพัะฐ ััะธะปั ะฒะตะดัั ะฝะต ััะดะฐ"

1. ะกะผะพััะธะผ ะญะบัะฐะฝ 8 โ ะบะปะฐะฒะธะฐัััะฐ `get_style_keyboard()`
2. ะะดัะผ ะฒ `keyboards/inline.py` โ ะฝะฐัะพะดะธะผ ััะฝะบัะธั
3. ะัะพะฒะตััะตะผ callback ะบะฝะพะฟะบะธ "ะะฐะทะฐะด": ะดะพะปะถะตะฝ ะฑััั `back_to_mode_selection`

---

## ๐ฏ ะะซะกะขะะซะ ะกะะะะะะงะะะ

### ะะพ ะฝะพะผะตัั ัะบัะฐะฝะฐ:

| โ | ะะฐะทะฒะฐะฝะธะต | ะคะฐะนะป | ะคัะฝะบัะธั |
|---|----------|------|---------|
| 1 | START/MAIN_MENU | user_start.py | start_command(), go_to_main_menu() |
| 2 | PROFILE | user_start.py | profile_callback() |
| 3 | HOME_MENU | user_start.py | home_menu() |
| 4 | BUSINESS_MENU | user_start.py | business_menu() |
| 5 | DESIGN_MODE_SELECTOR | user_start.py | room_selected() |
| 6 | UPLOAD_PHOTO | creation.py | choose_new_photo() |
| 7 | CHOOSE_ROOM | creation.py | photo_uploaded() |
| 8 | CHOOSE_STYLE | creation.py | room_chosen(), mode_select_design() |
| 9 | CHOOSE_FURNITURE | design_step1_furniture.py | show_furniture_screen() |
| 10 | CHOOSE_COLORS | design_step2_colors.py | show_colors_screen() |
| 11 | GENERATING | creation.py | style_chosen() (ะฟัะพัะตัั) |
| 12 | RESULT | creation.py | style_chosen() (ัะตะทัะปััะฐั) |
| 13 | PAYMENT_PACKAGES | payment.py | show_packages() |
| 14 | PAYMENT_CREATED | payment.py | create_payment() |
| 15 | PAYMENT_SUCCESS | payment.py | check_payment() |
| 16 | NO_BALANCE | creation.py | ัะฐะทะปะธัะฝัะต ะฟัะพะฒะตัะบะธ ะฑะฐะปะฐะฝัะฐ |
| 17 | ADMIN_PANEL | admin.py | admin ััะฝะดะปะตัั |

---

**ะะพะฝะตั ะดะพะบัะผะตะฝัะฐ**  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 27.11.2024 11:51
